<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Reconstruction algorithm | Order book reconstruction from quotes and trades streams</title>
  <meta name="description" content="2 Reconstruction algorithm | Order book reconstruction from quotes and trades streams" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Reconstruction algorithm | Order book reconstruction from quotes and trades streams" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Reconstruction algorithm | Order book reconstruction from quotes and trades streams" />
  
  
  

<meta name="author" content="Petr Fedorov" />


<meta name="date" content="2020-03-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction.html"/>
<link rel="next" href="results.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#continous-time-double-auction-and-lob"><i class="fa fa-check"></i><b>1.1</b> Continous-time double auction and LOB</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#available-data-sets"><i class="fa fa-check"></i><b>1.2</b> Available data sets</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reconstruction-algorithm.html"><a href="reconstruction-algorithm.html"><i class="fa fa-check"></i><b>2</b> Reconstruction algorithm</a><ul>
<li class="chapter" data-level="2.1" data-path="reconstruction-algorithm.html"><a href="reconstruction-algorithm.html#order"><i class="fa fa-check"></i><b>2.1</b> Order</a></li>
<li class="chapter" data-level="2.2" data-path="reconstruction-algorithm.html"><a href="reconstruction-algorithm.html#order-book"><i class="fa fa-check"></i><b>2.2</b> Order Book</a></li>
<li class="chapter" data-level="2.3" data-path="reconstruction-algorithm.html"><a href="reconstruction-algorithm.html#quotes-and-trades-streams"><i class="fa fa-check"></i><b>2.3</b> Quotes and Trades Streams</a></li>
<li class="chapter" data-level="2.4" data-path="reconstruction-algorithm.html"><a href="reconstruction-algorithm.html#coupling"><i class="fa fa-check"></i><b>2.4</b> Coupling</a><ul>
<li class="chapter" data-level="2.4.1" data-path="reconstruction-algorithm.html"><a href="reconstruction-algorithm.html#makers"><i class="fa fa-check"></i><b>2.4.1</b> Makers</a></li>
<li class="chapter" data-level="2.4.2" data-path="reconstruction-algorithm.html"><a href="reconstruction-algorithm.html#takers"><i class="fa fa-check"></i><b>2.4.2</b> Takers</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="reconstruction-algorithm.html"><a href="reconstruction-algorithm.html#order-intervals-reconstruction"><i class="fa fa-check"></i><b>2.5</b> Order Intervals Reconstruction</a></li>
<li class="chapter" data-level="2.6" data-path="reconstruction-algorithm.html"><a href="reconstruction-algorithm.html#enforcement-of-ime-condition-in-eob"><i class="fa fa-check"></i><b>2.6</b> Enforcement of IME condition in EOB</a></li>
<li class="chapter" data-level="2.7" data-path="reconstruction-algorithm.html"><a href="reconstruction-algorithm.html#enforcement-of-vc-condition-in-eob"><i class="fa fa-check"></i><b>2.7</b> Enforcement of VC condition in EOB</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>3</b> Results</a><ul>
<li class="chapter" data-level="3.1" data-path="results.html"><a href="results.html#fragments-of-quotes-and-trades-streams"><i class="fa fa-check"></i><b>3.1</b> Fragments of Quotes and Trades Streams</a><ul>
<li class="chapter" data-level="3.1.1" data-path="results.html"><a href="results.html#bitstamp-quotes"><i class="fa fa-check"></i><b>3.1.1</b> Bitstamp Quotes</a></li>
<li class="chapter" data-level="3.1.2" data-path="results.html"><a href="results.html#bitstamp-trades"><i class="fa fa-check"></i><b>3.1.2</b> Bitstamp Trades</a></li>
<li class="chapter" data-level="3.1.3" data-path="results.html"><a href="results.html#bitfinex-quotes"><i class="fa fa-check"></i><b>3.1.3</b> Bitfinex Quotes</a></li>
<li class="chapter" data-level="3.1.4" data-path="results.html"><a href="results.html#bitfinex-trades"><i class="fa fa-check"></i><b>3.1.4</b> Bitfinex Trades</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="results.html"><a href="results.html#optimal-maker-coupling-for-fragments"><i class="fa fa-check"></i><b>3.2</b> Optimal Maker Coupling for Fragments</a><ul>
<li class="chapter" data-level="3.2.1" data-path="results.html"><a href="results.html#bitstamp"><i class="fa fa-check"></i><b>3.2.1</b> Bitstamp</a></li>
<li class="chapter" data-level="3.2.2" data-path="results.html"><a href="results.html#bitfinex"><i class="fa fa-check"></i><b>3.2.2</b> Bitfinex</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="discussion.html"><a href="discussion.html"><i class="fa fa-check"></i><b>4</b> Discussion</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Order book reconstruction from quotes and trades streams</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="reconstruction-algorithm" class="section level1">
<h1><span class="header-section-number">2</span> Reconstruction algorithm</h1>
<div id="order" class="section level2">
<h2><span class="header-section-number">2.1</span> Order</h2>
<p>Consider a definition given in <span class="citation">(Bouchaud and Bonart 2018)</span>:</p>
<blockquote>
<p>An order is a commitment, declared at a given submission time, to buy or sell a given volume of an asset at no worse than a given price. An order <span class="math inline">\(x\)</span> is thus described by four attributes:</p>
<ul>
<li>its sign (or direction) <span class="math inline">\(\epsilon = \pm 1\)</span>, (<span class="math inline">\(\epsilon_x = +1\)</span> for buy orders; <span class="math inline">\(\epsilon_x = −1\)</span> for sell orders),</li>
<li>its price <span class="math inline">\(p_x\)</span> ,</li>
<li>its volume <span class="math inline">\(v_x &gt; 0\)</span>, and</li>
<li>its submission time <span class="math inline">\(t_x\)</span>.</li>
</ul>
<p>We introduce the succinct notation <span class="math inline">\(x := (\epsilon_x , p_x ,v_x, t_x )\)</span>.</p>
</blockquote>
<p><span class="citation">(Bouchaud and Bonart 2018)</span> then continues with a description of what they call The Trade-Matching Algorithm:</p>
<blockquote>
<p>Whenever a trader submits a buy (respectively, sell) order <span class="math inline">\(x\)</span>, an LOB’s <em>trade-matching algorithm</em> checks whether it is possible for <span class="math inline">\(x\)</span> to match to existing sell (respectively,buy)orders <span class="math inline">\(y\)</span> such that <span class="math inline">\(p_y \leq p_x\)</span> (respectively, <span class="math inline">\(p_y \geq p_x\)</span>). If so, the matching occurs immediately and the relevant traders perform a trade for the agreed amount at the agreed price. Any portion of <span class="math inline">\(x\)</span> that does not match instead becomes active at the price <span class="math inline">\(p_x\)</span>, and it remains active until either it matches to an incoming sell (respectively, buy) order or it is cancelled. Cancellation usually occurs when the owner of an order no longer wishes to offer a trade at the stated price.</p>
</blockquote>
<p>Above definition and description are incomplete:</p>
<ul>
<li><p>According to the definition, an order <span class="math inline">\(x\)</span> seems to be an immutable entity. But according to the Trade-Matching algorithm, a portion of <span class="math inline">\(x\)</span> may become ‘active’ and it is not clear how the quality of being ‘active’ is different from the mere existence of submitted orders,</p></li>
<li><p>At what price the trade is performed - <span class="math inline">\(p_x\)</span> or <span class="math inline">\(p_y\)</span> - is not explicitly stated,</p></li>
<li><p>It is not stated what will happen if <span class="math inline">\(v_x \leq v_y\)</span>, etc.</p></li>
</ul>
<p>Surprisingly, the concept of order and operations of a continous double auction appear to be rather complicated things if one attempts to define them rigorously!</p>
<p>Hereafter is assumed that a single asset is traded and a single currency is used.</p>

<div class="definition">
<p><span id="def:order" class="definition"><strong>Definition 2.1  (Order)  </strong></span>Suppose that:</p>
<ol style="list-style-type: lower-alpha">
<li><span class="math inline">\(i \in \mathbb{N}\)</span> is called an <em>unique order identification</em>,</li>
<li><p><span class="math inline">\(\mathcal{T^i}\)</span> is a set of intervals <span class="math inline">\(\mathcal{T^i} = \{T_k^i\}_{k=0}^{K^i}\)</span> called <em>order intervals</em> where each <span class="math inline">\(T_k^i\)</span> is either a proper interval with endpoints <span class="math inline">\(s_k^i \in \mathbb{R}_{&gt;0}\)</span>, <span class="math inline">\(e_k^i \in \mathbb{R}_{&gt;0} \cup \{+\infty\}\)</span>, <span class="math inline">\(s_k^i &lt; e_k^i\)</span> or a degenerate interval <span class="math inline">\(\{s_k^i\}, s_k^i \in \mathbb{R}_{&gt;0}\)</span> and <span class="math inline">\(\forall m \neq n : T_m^i \cap T_n^i = \emptyset\)</span>,</p></li>
<li><p><span class="math inline">\(\chi_{T_k^i} : \mathbb{R} \mapsto \{0,1\}\)</span> is an indicator function of intervals in <span class="math inline">\(\mathcal{T^i}\)</span>:
<span class="math inline">\(\chi_{T_k^i}(t) = \begin{cases} 1, &amp; t \in T_k^i \\ 0, &amp; \text{otherwise} \end{cases}\)</span>,</p></li>
<li><p><span class="math inline">\(\mathcal{P}^i = \{p_k^i\}_{k=0}^{K^i}\)</span> is a set of constants <span class="math inline">\(p_k^i \in \mathbb{R}_{&gt;0}\)</span> called <em>order prices</em>,</p></li>
<li><p><span class="math inline">\(\mathcal{V}^i = \{v_k^i\}_{k=0}^{K^i}\)</span> is a set of constants called <em>order volumes</em>, such that either <span class="math inline">\(v_k^i \in \mathbb{R}_{&lt;0}\)</span> or <span class="math inline">\(v_k^i \in \mathbb{R}_{&gt;0}\)</span>,</p></li>
<li><p>Sets <span class="math inline">\(\mathcal{P}^i\)</span> and <span class="math inline">\(\mathcal{V}^i\)</span> satisfy the following condition <span class="math inline">\(\forall k \in [0, \ldots, N_i) : (p_k^i, v_k^i) \neq (p_{k+1}^i, v_{k+1}^i)\)</span>,</p></li>
</ol>
Then a vector-valued function <span class="math inline">\(\mathbf{o}^i(t) : \mathbb{R}_{&gt;0} \mapsto \mathbb{R}_{&gt;0} \times \mathbb{R}\)</span> representing a commitment to buy or sell a given volume <span class="math inline">\(v\)</span> of an asset at no worse than a given price <span class="math inline">\(p\)</span> at a particular time <span class="math inline">\(t\)</span> with a closed form:
<span class="math display">\[
  \mathbf{o}^i(t) = (p^i(t), v^i(t)) = \Big( \sum_{k=1}^{K^i} p_k^i \chi_{T_k^i}(t),  \sum_{k=1}^{K^i} v_k^i \chi_{T_k^i}(t) \Big)
\]</span> is called an <em>order</em>. If <span class="math inline">\(v_k^i \in \mathbb{R}_{&lt;0}\)</span> the order is a commitment to <em>sell</em> and is also called a <em>sell order</em>. If <span class="math inline">\(v_k^i \in \mathbb{R}_{&gt;0}\)</span> the order is a commitment to <em>buy</em> and is also called a <em>buy order</em>.
</div>

<p>Whenever it is clear from the context, we may also use the word order for:</p>
<ul>
<li>An unique order identification <span class="math inline">\(i\)</span> number</li>
<li>An order as defined in <span class="citation">(Bouchaud and Bonart 2018)</span> (see above)</li>
<li>The value of tuple <span class="math inline">\((i, p^i(t_0), v^i(t_0))\)</span> at the particular time <span class="math inline">\(t_0\)</span></li>
</ul>
<p>Now we can define</p>

<div class="definition">
<span id="def:order-volume" class="definition"><strong>Definition 2.2  (Order Volume)  </strong></span>The function <span class="math inline">\(v^i(t)\)</span> in definition <a href="reconstruction-algorithm.html#def:order">2.1</a> is called an <em>order volume</em>.
</div>


<div class="definition">
<span id="def:order-price" class="definition"><strong>Definition 2.3  (Order Price)  </strong></span>The function <span class="math inline">\(p^i(t)\)</span> in definition <a href="reconstruction-algorithm.html#def:order">2.1</a> is called an <em>order price</em>.
</div>


<div class="definition">
<span id="def:fill-volume" class="definition"><strong>Definition 2.4  (Filled Volume and Trade)  </strong></span>The filled volume <span class="math inline">\(f^i(t)\)</span> of an order <span class="math inline">\(i\)</span> at time <span class="math inline">\(t\)</span> is defined as:
<span class="math display">\[
  f^i(t) = v^i(t) - \lim_{t^{&#39;} \downarrow t} v^i(t^{&#39;})
  \]</span>
The tuple <span class="math inline">\((t, f^i(t), p^i(t))\)</span> is called a <em>trade</em>. If order <span class="math inline">\(i\)</span> is a buy order then the trade is called a <em>sell trade</em>. Otherwise it is a <em>buy trade</em>.
</div>


<div class="definition">
<span id="def:cancelled-volume" class="definition"><strong>Definition 2.5  (Cancelled Volume)  </strong></span>The cancelled volume <span class="math inline">\(c^i(t)\)</span> of an order <span class="math inline">\(i\)</span> at time <span class="math inline">\(t\)</span> is defined as:
<span class="math display">\[
  c^i(t) = \lim_{t^{&#39;} \uparrow t} v^i(t^{&#39;}) - v^i(t)
  \]</span>
</div>

</div>
<div id="order-book" class="section level2">
<h2><span class="header-section-number">2.2</span> Order Book</h2>

<div class="definition">
<span id="def:order-book" class="definition"><strong>Definition 2.6  (Order Book)  </strong></span>A set of orders <span class="math inline">\(\mathcal{O} = \{\mathbf{o}^i(t)\}_i\)</span> is called an <em>order book</em>.
</div>


<div class="definition">
<span id="def:order-placement-policy" class="definition"><strong>Definition 2.7  (Order Placement Policy)  </strong></span>Suppose that <span class="math inline">\(\mathbb{O}\)</span> is a set of all Order Books <span class="math inline">\(\mathcal{O}\)</span> as defined by <a href="reconstruction-algorithm.html#def:order-book">2.6</a>. The function <span class="math display">\[\mathcal{P}(\mathcal{O},i, t, p, v) : \mathbb{O} \times \mathbb{N} \times  \mathbb{R}_{&gt;0} \times \mathbb{R}_{&gt;0} \times \mathbb{R}_{\neq 0} \mapsto \mathbb{O}\]</span> is called an <em>order placement policy</em>. It defines how order <span class="math inline">\(i\)</span> placement or update submitted at time <span class="math inline">\(t\)</span> with price <span class="math inline">\(p\)</span> and volume <span class="math inline">\(v\)</span> is added to the order book <span class="math inline">\(\mathcal{O}\)</span> and how the existing orders in <span class="math inline">\(\mathcal{O}\)</span> are modified, if necessesary.
</div>


<div class="definition">
<span id="def:best-bid-price" class="definition"><strong>Definition 2.8  (Best Bid Price)  </strong></span>Suppose we are given an order book <span class="math inline">\(\mathcal{O}\)</span>. A (possibly empty) subset <span class="math inline">\(\mathcal{B} =\{\mathbf{o}^b(t)\}_{v_k^b &gt; 0} \subset \mathcal{O}\)</span> of buy orders is called <em>bids</em> and the function <span class="math inline">\(b(t)\)</span> is defined as:
<span class="math display">\[
  b_{\mathcal{O}}(t) = \begin{cases} \max_{\mathbf{o}^b(t) \in \mathcal{B}} p^b(t), &amp; \text{ if } \mathcal{B} \neq \emptyset \\0, &amp; \text{ otherwise }  \end{cases}
  \]</span> is called <em>best bid price</em>.
</div>


<div class="definition">
<span id="def:best-ask-price" class="definition"><strong>Definition 2.9  (Best Ask Price)  </strong></span>Suppose we are given an order book <span class="math inline">\(\mathcal{O}\)</span>. A (possibly empty) subset <span class="math inline">\(\mathcal{A} =\{\mathbf{o}^a(t)\}_{v_k^a &lt; 0} \subset \mathcal{O}\)</span> of sell orders is called <em>asks</em> and the function <span class="math inline">\(a(t)\)</span> is defined as:
<span class="math display">\[
  a_{\mathcal{O}}(t) = \begin{cases} \min_{\mathbf{o}^a(t) \in \mathcal{A}} p^a(t) &amp; \text{ if } \mathcal{A} \neq \emptyset \\ +\infty, &amp; \text{ otherwise } \end{cases}
  \]</span> is called <em>best ask price</em>.
</div>


<div class="definition">
<span id="def:match" class="definition"><strong>Definition 2.10  (Matched Orders)  </strong></span>Suppose we are given an order book <span class="math inline">\(\mathcal{O}\)</span>. A buy order <span class="math inline">\(\mathbf{o}^b(t) \in \mathcal{O}\)</span> and a sell order <span class="math inline">\(\mathbf{o}^s(t) \in \mathcal{O}\)</span> are called <em>matched</em> if <span class="math inline">\(\exists t : p^b(t) \geq p^s(t)\)</span>. If <span class="math display">\[\lim_{t^{&#39;} \uparrow t} p^s(t) \neq p^s(t)\]</span> then <span class="math inline">\(\mathbf{o}^s(t)\)</span> is called a <em>taker</em> order and <span class="math inline">\(\mathbf{o}^b(t)\)</span> is called a <em>maker</em> order. Otherwise, <span class="math inline">\(\mathbf{o}^b(t)\)</span> is called a <em>taker</em> order and <span class="math inline">\(\mathbf{o}^s(t)\)</span> is called a <em>maker</em> order.
The set of matched buy orders at time <span class="math inline">\(t\)</span> we will denote <span class="math inline">\(\mathcal{M}_{\text{bid}}(t)\)</span> and the set of matched sell orders - <span class="math inline">\(\mathcal{M}_{\text{ask}}(t)\)</span>.
</div>


<div class="definition">
<p><span id="def:iob" class="definition"><strong>Definition 2.11  (Ideal Order Book)  </strong></span>Suppose we are given an order book <span class="math inline">\(\mathcal{O}\)</span>. Then <span class="math inline">\(\mathcal{O}\)</span> is called <em>Ideal Order Book (IOB)</em> if the following conditions are satisfied:</p>
<ol style="list-style-type: lower-alpha">
<li>Instantaneous Match Execution (IME)
<span class="math display" id="eq:instant-match">\[ \lambda \Big( \{t : b_{\mathcal{O}}(t) \geq a_{\mathcal{O}}(t)\}\Big) = 0
\tag{2.1}
  \]</span> where <span class="math inline">\(\lambda(X)\)</span> is the Lebesgue measure of set <span class="math inline">\(X\)</span>.</li>
<li>Volume Conservation (VC)
<span class="math display" id="eq:volume-conservation">\[
    \forall t \in \{t : b_{\mathcal{O}}(t) \geq a_{\mathcal{O}}(t)\} : \sum_{\mathbf{o}^b(t) \in \mathcal{M}_{\text{bid}}(t)} f^b(t) = \sum_{\mathbf{o}^s(t) \in \mathcal{M}_{\text{ask}}(t)} |f^s(t)|
    \tag{2.2}
    \]</span></li>
</ol>
</div>

<p>To make these definitions intuitevely clear, let’s consider how IOB <span class="math inline">\(\mathcal{O}\)</span> would evolve under some order placement policy <span class="math inline">\(\mathcal{P}\)</span> in a typical scenario of placing several buy and sell orders. Note that our policy <span class="math inline">\(\mathcal{P}\)</span> given IOB retuns IOB. It is not the case in general and another order placement policy could retrun order book which is not IOB.</p>
<ol style="list-style-type: decimal">
<li><p>A buy order is submitted at time <span class="math inline">\(t_1\)</span> with the price <span class="math inline">\(p_1\)</span> and volume <span class="math inline">\(v_1\)</span> and is transformed by <span class="math inline">\(\mathcal{P}\)</span> into <span class="math inline">\(\mathbf{o}^1(t)\)</span>:</p>
<ul>
<li><span class="math inline">\(\mathbf{o}^1(t)\)</span> is added to <span class="math inline">\(\mathcal{O}\)</span>: <span class="math display">\[
\mathbf{o}^1(t) = \left[
 \begin{eqnarray}
\mathcal{T}^1 &amp; = &amp; \{ [t_1, +\infty) \} \\
\mathcal{P}^1 &amp; = &amp; \{ p_1 \} \\
\mathcal{V}^1 &amp; = &amp; \{ v_1 \}
 \end{eqnarray} 
 \right.
 \]</span></li>
</ul></li>
<li><p>A sell order with price <span class="math inline">\(p_2 &lt; p_1\)</span> and volume <span class="math inline">\(|v_2| &lt; |v_1|\)</span> is submitted and transformed into <span class="math inline">\(\mathbf{o}^2(t)\)</span>, matched with <span class="math inline">\(\mathbf{o}^1(t)\)</span> so the latter is partially filled at time <span class="math inline">\(t_2\)</span>. All these actions are performed by <span class="math inline">\(\mathcal{P}\)</span>. Note that the right endpoint <span class="math inline">\(t_2\)</span> below is included:</p>
<ul>
<li><span class="math inline">\(\mathbf{o}^1(t)\)</span> is changed: <span class="math display">\[
\mathbf{o}^1(t) = \left[
 \begin{eqnarray}
\mathcal{T}^1 &amp; = &amp; \{ [t_1, t_2], (t_2, +\infty] \} \\
\mathcal{P}^1 &amp; = &amp; \{ p_1, p_1 \} \\
\mathcal{V}^1 &amp; = &amp; \{ v_1, v_1 - v_2 \}
\end{eqnarray}
\right.
\]</span></li>
<li><span class="math inline">\(\mathbf{o}^2(t)\)</span> is added to <span class="math inline">\(\mathcal{O}\)</span>: <span class="math display">\[
\mathbf{o}^2(t) = \left[
 \begin{eqnarray}
\mathcal{T}^2 &amp; = &amp; \{ {t_2} \} \\
\mathcal{P}^2 &amp; = &amp; \{ p_2 \} \\
\mathcal{V}^2 &amp; = &amp; \{ v_2 \}
\end{eqnarray}
\right.
\]</span></li>
</ul></li>
<li>A sell order with price <span class="math inline">\(p_3 &lt; p_1\)</span> and volume <span class="math inline">\(v_3\)</span> is submitted by the same trader as the one who submitted <span class="math inline">\(\mathbf{o}^1(t)\)</span>. The order is transformed into <span class="math inline">\(\mathbf{o}^3(t)\)</span> and <span class="math inline">\(\mathbf{o}^1(t)\)</span> is cancelled (note that the right endpoint <span class="math inline">\(t_3\)</span> below is not included) due to self-trade prevention policy, which is part of <span class="math inline">\(\mathcal{P}\)</span>, at time <span class="math inline">\(t_3\)</span> (as, for example, CME Globex would do by default):
<ul>
<li><span class="math inline">\(\mathbf{o}^1(t)\)</span> is changed: <span class="math display">\[
\mathbf{o}^1(t) = \left[
 \begin{eqnarray}
\mathcal{T}^1 &amp; = &amp; \{ [t_1, t_2], (t_2, t_3) \} \\
\mathcal{P}^1 &amp; = &amp; \{ p_1, p_1 \} \\
\mathcal{V}^1 &amp; = &amp; \{ v_1, v_1 - v_2 \}
\end{eqnarray}
\right.
\]</span></li>
<li><span class="math inline">\(\mathbf{o}^2(t)\)</span> remains the same,</li>
<li><span class="math inline">\(\mathbf{o}^3(t)\)</span> is added to <span class="math inline">\(\mathcal{O}\)</span>: <span class="math display">\[
\mathbf{o}^3(t) = \left[
 \begin{eqnarray}
\mathcal{T}^3 &amp; = &amp; \{ [t_3, +\infty) \} \\
\mathcal{P}^3 &amp; = &amp; \{ p_3 \} \\
\mathcal{V}^3 &amp; = &amp; \{ v_3 \}
\end{eqnarray}
\right.
\]</span></li>
</ul></li>
</ol>
</div>
<div id="quotes-and-trades-streams" class="section level2">
<h2><span class="header-section-number">2.3</span> Quotes and Trades Streams</h2>
<p>Formally speaking, the reconstruction algorithm is supposed to produce Ideal Order Book from non-ideal data - Quotes and Trades Streams - provided by an exchange. The effort required varies by an exchange. For example <a href="https://www.moex.com/">MOEX</a> provides data of close to ideal quality while <a href="https://www.moex.com/">Bitfinex</a> does not report unique order identifications for trades and omits market orders altogether.</p>

<div class="definition">
<p><span id="def:quote-event" class="definition"><strong>Definition 2.12  (Quote Event)  </strong></span>A tuple <span class="math inline">\(\mathcal{S}_Q^i[k] = (t_k^i, i, k, p_k^i, v_k^i, e^k_i)\)</span> where</p>
<ol style="list-style-type: lower-alpha">
<li><span class="math inline">\(t_k^i \in \mathbb{R}_{&gt; 0}\)</span> is a timestamp,</li>
<li><span class="math inline">\(i \in \mathbb{N}\)</span> is an identification number of the quote,</li>
<li><span class="math inline">\(k \in \mathbb{N}\)</span> is a quote event number,</li>
<li><span class="math inline">\(p_k^i \in \mathbb{R}_{\geq 0}\)</span> is a quote price at <span class="math inline">\(t_k^i\)</span>,</li>
<li><span class="math inline">\(v_k^i \in \mathbb{R}\)</span> is a quote volume since <span class="math inline">\(t_k^i\)</span>,</li>
<li><span class="math inline">\(e_k^i \in \{ A, C, D \}\)</span> is an event type: <span class="math inline">\(A\)</span> stands for addition to an order book event, <span class="math inline">\(C\)</span> stands for change event and <span class="math inline">\(D\)</span> stands for deletion from an order book,</li>
</ol>
is called <em>quote <span class="math inline">\(i\)</span> event number <span class="math inline">\(k\)</span></em>.
</div>


<div class="definition">
<p><span id="def:quote" class="definition"><strong>Definition 2.13  (Quote)  </strong></span>A set of quote event tuples <span class="math inline">\(\mathcal{S}_Q^i =\{\mathcal{S}_Q^i[k] \}_{k=1}^{K^i} = \{(t_k^i, i, k, p_k^i, v_k^i, e^k_i)\}_{k=1}^{K^i}\)</span> where</p>
<ol style="list-style-type: lower-alpha">
<li><span class="math inline">\(k_1 &lt; k_2 \implies t_{k_1}^i \leq t_{k_2}^i\)</span>,</li>
<li>all <span class="math inline">\(v_k^i\)</span> are either non-negative or non-positive</li>
</ol>
<p>is called <em>quote <span class="math inline">\(i\)</span></em>. If all <span class="math inline">\(v_k^i \leq 0\)</span> then the quote is a <em>sell quote</em>. Otherwise it is a <em>buy quote</em>.</p>
</div>


<div class="definition">
<span id="def:volume-decreasing-quote-event" class="definition"><strong>Definition 2.14  (Volume Decreasing Quote Event)  </strong></span>
Suppose a quote <span class="math inline">\(\mathcal{S}_Q^i =\{\mathcal{S}_Q^i[k] \}_{k=1}^{K^i} = \{(t_k^i, i, k, p_k^i, v_k^i, e^k_i)\}_{k=1}^{K^i}\)</span> as defined by <a href="reconstruction-algorithm.html#def:quote">2.13</a> is given. The value <span class="math display">\[\Delta v_k^i = |v_{k-1}^i| - |v_k^i|, k &gt; 1\]</span> is called a <em>volume decrease of quote <span class="math inline">\(i\)</span> event <span class="math inline">\(k\)</span></em>. A volume decrease of quote <span class="math inline">\(i\)</span> event <span class="math inline">\(1\)</span> is undefined. A quote event <span class="math inline">\(\mathcal{S}_Q^i[k] \in \mathcal{S}_Q^i\)</span> is called a <em>volume decreasing quote event</em> if it has a positive volume decrease, i.e. if <span class="math inline">\(|v_k^i| &lt; |v_{k-1}^i|\)</span>.
</div>


<div class="definition">
<span id="def:quotes-stream" class="definition"><strong>Definition 2.15  (Quotes Stream)  </strong></span>A union of quotes <span class="math display">\[\mathcal{S}_Q = \bigcup_i \mathcal{S}_Q^i = \bigcup_i \{(t_k^i, i, k, p_k^i, v_k^i, e^k_i)\}_{k=1}^{K^i}\]</span> is called <em>Quotes Stream</em>.
</div>

<p>Table <a href="results.html#tab:stamp-quote-frag">3.1</a> in section <a href="results.html#fragments-of-quotes-and-trades-streams">Fragments of Quotes and Trades Streams</a> shows a fragment of ETHUSD Quotes Stream generated by Bitstamp during 1 second<br />
while table <a href="results.html#tab:finex-quote-frag">3.3</a> shows similar fragment generated by Bitfinex. They should be taken as a raw dataset for illustrations of reconstruction algorithm performance hereafter.</p>

<div class="definition">
<p><span id="def:trade" class="definition"><strong>Definition 2.16  (Trade)  </strong></span>A tuple <span class="math inline">\(\mathcal{S}_T[j] = (t_j, j, a_j, r_j, d_j, p_j, v_j)\)</span> where</p>
<ol style="list-style-type: lower-alpha">
<li><span class="math inline">\(t_j \in \mathbb{R}_{&gt;0}\)</span> is a timestamp of the trade,</li>
<li><span class="math inline">\(j \in \mathbb{N}\)</span> is a unque trade identification number,</li>
<li><span class="math inline">\(a_j \in \mathbb{N} \cup \{0\}\)</span> is an optional taker (aggressing) quote identification number: if <span class="math inline">\(a_j =`\{0\}\)</span> then the number is not known,</li>
<li><span class="math inline">\(r_j \in \mathbb{N} \cup \{0\}\)</span> is an optional maker (resting) quote identification number: if <span class="math inline">\(a_j =\{0\}\)</span> then the number is not known,</li>
<li><span class="math inline">\(d_j \in \{-1, +1\}\)</span> is the side of the maker quote (if <span class="math inline">\(d_j = -1\)</span> then ‘ask’, otherwise ‘bid’)</li>
<li><span class="math inline">\(p_j \in \mathbb{R}_{&gt;0}\)</span> is a trade price,</li>
<li><span class="math inline">\(v_j \in \mathbb{R}_{\neq 0}\)</span> is a trade volume</li>
</ol>
is called <em>trade</em>. If <span class="math inline">\(d_j = -1\)</span> then the trade is a <em>buy trade</em>. Otherwise it is a <em>sell trade</em>.
</div>


<div class="definition">
<p><span id="def:trades-stream" class="definition"><strong>Definition 2.17  (Trades Stream)  </strong></span>A set of trades <span class="math display">\[\mathcal{S}_T = \{\mathcal{S}_T[j]\}_{j=1}^{J} = \{(t_j, j, a_j, r_j, d_j, p_j, v_j)\}_{j=0}^{J}\]</span> where</p>
<ol style="list-style-type: lower-alpha">
<li><span class="math inline">\(j_1 \neq j_2 \implies \ (a_{j_1}, r_{j_1}) \neq (a_{j_2}, r_{j_2})\)</span></li>
<li><span class="math inline">\(j_1 &lt; j_2 \implies t_{j_1} \leq t_{j_2}\)</span></li>
</ol>
<p>is called a <em>Trades Stream</em>.</p>
</div>

<p>Table <a href="results.html#tab:stamp-trade-frag">3.2</a> in section <a href="results.html#fragments-of-quotes-and-trades-streams">Fragments of Quotes and Trades Streams</a> shows a fragment of ETHUSD Trades Stream generated by Bitstamp during 1 second while table <a href="results.html#tab:finex-trade-frag">3.4</a> shows similar fragment generated by Bitfinex.</p>

<div class="definition">
<span id="def:empirical-order" class="definition"><strong>Definition 2.18  (Empirical Order)  </strong></span>An order <span class="math inline">\(\hat{\mathbf{o}}^{i}(t)\)</span> as defined by <a href="reconstruction-algorithm.html#def:order">2.1</a> which has been in some way constructed from the <em>quote</em> <span class="math inline">\(\{(t_k^i, i, p_k^i, v_k^i)\}_{k=1}^{K^i} \in \mathcal{S}_Q\)</span> as defined by <a href="reconstruction-algorithm.html#def:quote">2.13</a> is called an <em>empirical order</em>.
</div>


<div class="definition">
<span id="def:eob" class="definition"><strong>Definition 2.19  (Empirical Order Book)  </strong></span>A set of empirical orders <span class="math inline">\(\hat{\mathcal{O}} = \{\hat{\mathbf{o}}^i(t)\}_i\)</span> is called <em>Empirical Order Book(EOB)</em>.
</div>

<p>A typical exchange gives us some kind of event stream and, separately, some kind of trade stream with various level of details.</p>
<p>As it is shown below, most of quote events may be uniquely utilized for construction of an empirical order since those quote events can be caused by unique actions. The only ambiguous exception is a volume decreasing quote event which may originate from</p>
<ol style="list-style-type: lower-alpha">
<li>A single fill</li>
<li>Multiple fills (i.e. several taker orders matched with a single maker order simultaneously)</li>
<li>A cancellation</li>
<li>Combination of the above (i.e. <a href="https://www.investopedia.com/terms/i/immediateorcancel.asp">Immediate or Cancel Order</a>)</li>
</ol>
<p>These ambiguous volume decreasing quote events need, well, to be disambiguated before an empirical order can be constructed from the quote.</p>
</div>
<div id="coupling" class="section level2">
<h2><span class="header-section-number">2.4</span> Coupling</h2>
<div id="makers" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Makers</h3>

<div class="definition">
<p><span id="def:linkable-makers" class="definition"><strong>Definition 2.20  (Linkable Makers)  </strong></span>Suppose that Quotes Stream <span class="math inline">\(\mathcal{S}_Q\)</span> and Trades Stream <span class="math inline">\(\mathcal{S}_T\)</span> are given. For each trade <span class="math inline">\(\mathcal{S}_T[j] \in \mathcal{S}_T\)</span> as defined by <a href="reconstruction-algorithm.html#def:trade">2.16</a>, a (possibly empty) set <span class="math inline">\(\mathcal{L}_R[\mathcal{S}_T[j]] = \{\mathcal{S}_Q^r[k]\}_{r, k}\)</span> of a volume-decreasing quote events <span class="math inline">\(\mathcal{S}_Q^r[k] \in \mathcal{S}_Q^r \in \mathcal{S}_Q\)</span> as defined by <a href="reconstruction-algorithm.html#def:volume-decreasing-quote-event">2.14</a> that satisfy the following conditions:</p>
<ol style="list-style-type: lower-alpha">
<li><span class="math inline">\(\text{sgn}(v_k^r) = d_j\)</span>, i.e. <span class="math inline">\(\mathcal{S}_Q^r\)</span> is a resting (maker) quote for trade <span class="math inline">\(j\)</span>,</li>
<li><span class="math inline">\(r = r_j \lor r = 0\)</span>, i.e if trade <span class="math inline">\(j\)</span> contains maker quote identification number <span class="math inline">\(r_j &gt; 0\)</span> then <span class="math inline">\(\mathcal{S}_Q^r[k]\)</span> must belong to quote <span class="math inline">\(r_j\)</span>; otherwise it may belong to any other quote satisfying the other conditions of this definition,</li>
<li><span class="math inline">\(t_k^r - t_j &lt; \tau\)</span>, quote event <span class="math inline">\(\mathcal{S}_Q^r[k]\)</span> is no more than <span class="math inline">\(\tau \in \mathbb{R}_{&gt;0}\)</span> seconds later than trade <span class="math inline">\(j\)</span> and <em>delay tolerance</em> <span class="math inline">\(\tau\)</span> is usually small,</li>
<li><span class="math inline">\(p_k^r = p_j\)</span>,</li>
<li><span class="math inline">\(\begin{cases} \Delta v_k^i \geq v_j, &amp; k &gt; 1 \\ e^i_k = D, &amp; k = 1 \end{cases}\)</span>, i.e. the volume of trade <span class="math inline">\(j\)</span> is <em>smaller</em> that the volume decrease of quote <span class="math inline">\(\mathcal{S}_Q^r\)</span> at time <span class="math inline">\(t_k^r\)</span> or volume decrease is not defined and event type is a deletion,</li>
</ol>
<p>is called <em>linkable makers (‘resting’ quotes) for trade <span class="math inline">\(j\)</span></em>. The set <span class="math inline">\(\mathcal{L}_R = \bigcup_j \mathcal{L}_R[\mathcal{S}_T[j]]\)</span> is called <em>linkable makers</em>.</p>
</div>


<div class="definition">
<p><span id="def:hidden-makers" class="definition"><strong>Definition 2.21  (Hidden Makers)  </strong></span>Suppose that Quotes Stream <span class="math inline">\(\mathcal{S}_Q\)</span> and Trades Stream <span class="math inline">\(\mathcal{S}_T\)</span> are given. For each trade <span class="math inline">\(\mathcal{S}_T[j] \in \mathcal{S}_T\)</span> as defined by <a href="reconstruction-algorithm.html#def:trade">2.16</a>, a set <span class="math inline">\(\mathcal{H}_R[\mathcal{S}_T[j]]\)</span> defined as follows <span class="math display">\[
\mathcal{H}_R[\mathcal{S}_T[j]] = \mathcal{H}_R[(t_j, j, a_j, r_j, d_j, p_j, v_j)] = \{(t_j, j, 1, p_j, v_j, D)\}\]</span> is called <em>hidden maker for trade <span class="math inline">\(j\)</span></em>. The tuple <span class="math inline">\(\{(t_j, j, 1, p_j, v_j, D)\} = \{\mathcal{S}_Q^j[1]\}\)</span> is called a <em>hidden quote event for trade <span class="math inline">\(j\)</span></em>. The set <span class="math inline">\(\mathcal{H}_R = \bigcup_j \mathcal{H}_R[\mathcal{S}_T[j]]\)</span> is called <em>hidden makers</em>.</p>
</div>


<div class="definition">
<span id="def:maker-coupling" class="definition"><strong>Definition 2.22  (Maker Coupling)  </strong></span>Suppose that Quotes Stream <span class="math inline">\(\mathcal{S}_Q\)</span> and Trades Stream <span class="math inline">\(\mathcal{S}_T\)</span> are given. A function <span class="math display">\[
  \mathbf{l}_R(\cdot) :  \mathcal{S}_T \mapsto \mathcal{L}_R \cup \mathcal{H}_R
\]</span> such that <span class="math inline">\(\forall j: \mathbf{l}_R(\mathcal{S}_T[j]) \in \mathcal{L}_R[\mathcal{S}_T[j]] \cup \mathcal{H}_R[\mathcal{S}_T[j]]\)</span> is called a <em>maker coupling</em>. The symbol <span class="math inline">\(\mathcal{L}_R^{\mathbf{l}_R}\)</span> denotes the image of <span class="math inline">\(\mathbf{l}_R(\cdot)\)</span> function.
</div>

<p>If for some <span class="math inline">\(j\)</span> the cardinality of <span class="math inline">\(\mathcal{L}_R[\mathcal{S}_T[j]]\)</span> is greater than one then there are more than one different maker coupling <span class="math inline">\(\mathbf{l}_R(\mathcal{S}_T[j])\)</span> of Trade Stream <span class="math inline">\(\mathcal{S}_T\)</span> to Quotes Stream <span class="math inline">\(\mathcal{S}_Q\)</span>.</p>

<div class="definition">
<span id="def:inverse-maker-coupling" class="definition"><strong>Definition 2.23  (Inverse Maker Coupling)  </strong></span>The (possibly empty) set <span class="math display">\[\mathbf{l}_R^{-1}(\mathcal{S}^r_Q[k]) = \{ \mathcal{S}_T[j] : \mathbf{l}_R(\mathcal{S}_T[j]) = \mathcal{S}^r_Q[k] \in \mathcal{S}_Q \cup \mathcal{H}_R \}\]</span> is called an <em>inverse maker coupling set for quote event <span class="math inline">\(\mathcal{S}^r_Q[k]\)</span></em>.
</div>


<div class="definition">
<span id="def:concordance-volumes" class="definition"><strong>Definition 2.24  (Concordance of Volumes)  </strong></span>Suppose a maker coupling <span class="math inline">\(\mathbf{l}_R(\mathcal{S}_T[j])\)</span> as defined by <a href="reconstruction-algorithm.html#def:maker-coupling">2.22</a> is given. The functional <span class="math inline">\(\mathscr{Q}(\mathbf{l}_R)_V\)</span> calculated as <span class="math display">\[\mathscr{Q}_V(\mathbf{l}_R) = \sum_{\mathcal{S}^r_Q[k] \in \mathcal{L}_R^{\mathbf{l}_R}} \begin{cases} 0, &amp; \text{ if }  \sum_{\mathcal{S}_T[j] \in \mathbf{l}_R^{-1}(\mathcal{S}^r_Q[k])} v_j 
 = v^i_k \land \mathcal{S}^r_Q[k] \not \in \mathcal{H}_R \\ -1, &amp; \text{ if }  \sum_{\mathcal{S}_T[j] \in \mathbf{l}_R^{-1}(\mathcal{S}^r_Q[k])} v_j 
 = v^i_k \land \mathcal{S}^r_Q[k] \in \mathcal{H}_R \\  -1, &amp; \text{ if } k = 1 \land e^i_k = D \\ -1, &amp; \text{ if }  \sum_{\mathcal{S}_T[j] \in \mathbf{l}_R^{-1}(\mathcal{S}^r_Q[k])} v_j 
 &lt; v^i_k \\ -\infty, &amp; \text{ otherwise} \end{cases}\]</span> is called a <em>concordance of volumes</em>
</div>

<p>The condition <span class="math inline">\(k = 1 \land e^i_k = D\)</span> in defintion <a href="reconstruction-algorithm.html#def:concordance-volumes">2.24</a> means that Quotes Stream has a deletion event for order <span class="math inline">\(i\)</span> without previous addition and/or change event(s). The volume decrease of the quote <span class="math inline">\(i\)</span> event <span class="math inline">\(1\)</span> is not defined and the reasonable decision in this situation is to assume that it is equal to the volume of the linked trade.</p>

<div class="definition">
<span id="def:concordance-timestamps" class="definition"><strong>Definition 2.25  (Concordance of Timestamps)  </strong></span>Suppose a maker coupling <span class="math inline">\(\mathbf{l}_R(\mathcal{S}_T[j])\)</span> as defined by <a href="reconstruction-algorithm.html#def:maker-coupling">2.22</a> is given. The functional <span class="math inline">\(\mathscr{Q}(\mathbf{l}_R)_T\)</span> calculated as <span class="math display">\[\mathscr{Q}_T(\mathbf{l}_R) = -\sum_{(\mathcal{S}_T[j], \mathbf{l}_R(\mathcal{S}_T[j])) }t^r_k - t_j\]</span>
is called a <em>concordance of timestamps</em>
</div>

<p><span class="math inline">\(\DeclareMathOperator*{\argmax}{arg\,max}\)</span></p>

<div class="definition">
<p><span id="def:optimal-maker-coupling" class="definition"><strong>Definition 2.26  (Optimal Maker Coupling)  </strong></span>Suppose that Quotes Stream <span class="math inline">\(\mathcal{S}_Q\)</span> and Trades Stream <span class="math inline">\(\mathcal{S}_T\)</span> are given. The maker coupling
<span class="math display">\[ \mathbf{l}_R^* = \argmax_{\argmax_{\mathbf{l}_R} \mathscr{Q}_V(\mathbf{l}_R)}\, \mathscr{Q}_T(\mathbf{l}_R)  \]</span> is called the <em>optimal maker copling</em>.</p>
</div>

</div>
<div id="takers" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Takers</h3>
<p>Bitfinex does not provide quote events for takers while MOEX and Bitstamp do provide.</p>

<div class="definition">
<p><span id="def:linkable-takers" class="definition"><strong>Definition 2.27  (Linkable Takers)  </strong></span>Suppose that Quotes Stream <span class="math inline">\(\mathcal{S}_Q\)</span> and Trades Stream <span class="math inline">\(\mathcal{S}_T\)</span> are given. For each trade <span class="math inline">\(\mathcal{S}_T[j] \in \mathcal{S}_T\)</span> as defined by <a href="reconstruction-algorithm.html#def:trade">2.16</a>, a non-empty set of a volume-decreasing quote events <span class="math inline">\(\mathcal{S}_Q^i[k] \in \mathcal{S}_Q^i \in \mathcal{S}_Q\)</span> as defined by <a href="reconstruction-algorithm.html#def:volume-decreasing-quote-event">2.14</a> that satisfy the following conditions:</p>
<ol style="list-style-type: lower-alpha">
<li><span class="math inline">\(|t_j - t_k^i| &lt; \tau\)</span>, where <span class="math inline">\(\tau\)</span> is a constant,</li>
<li><span class="math inline">\(i = a_j\)</span> if the trade contains taker quote identification number,</li>
<li><span class="math inline">\(p_k^i d_j \leq p_j d_j\)</span>,</li>
<li><span class="math inline">\(\text{sgn}(v_k^i) = -d_j\)</span>,</li>
<li><span class="math inline">\(|v_k^i - v_{k-1}^i| \geq v_j\)</span></li>
</ol>
<p>is called <em>linkable takers for trade <span class="math inline">\(j\)</span></em>.</p>
</div>

<p>TBD</p>
</div>
</div>
<div id="order-intervals-reconstruction" class="section level2">
<h2><span class="header-section-number">2.5</span> Order Intervals Reconstruction</h2>
<p>To reconstruct an empirical order <span class="math inline">\(\hat{\mathbf{o}}^{i}(t)\)</span> as defined by <a href="reconstruction-algorithm.html#def:empirical-order">2.18</a> from the <em>Quotes Stream</em> <span class="math inline">\(\mathcal{S}_Q^i\)</span> as defined by <a href="reconstruction-algorithm.html#def:quotes-stream">2.15</a> one needs to define the set of intervals <span class="math inline">\(\mathcal{T^i}\)</span> since order prices <span class="math inline">\(\mathcal{P}^i\)</span> and order volumes <span class="math inline">\(\mathcal{V}^i\)</span> are unambiguously defined by the Quotes Stream <span class="math inline">\(\mathcal{S}_Q^i\)</span>.</p>
<p>TBD</p>
</div>
<div id="enforcement-of-ime-condition-in-eob" class="section level2">
<h2><span class="header-section-number">2.6</span> Enforcement of IME condition in EOB</h2>
<p>TBD</p>
</div>
<div id="enforcement-of-vc-condition-in-eob" class="section level2">
<h2><span class="header-section-number">2.7</span> Enforcement of VC condition in EOB</h2>
<p>TBD</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="results.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"search": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
